<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Promoções | Cartão AproveitAI</title>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <style>
    :root {
      --verde: #0a7f2e;
      --verde-esc: #065e1f;
      --bg1: #bdeeff;
      --bg2: #81d4fa;
      --card: #fff;
      --ink: #232630;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      color: var(--ink);
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--card);
      padding: 10px 20px;
    }
    header img { height: 80px; }
    h1 {
      color: var(--verde);
      font-size: 28px;
      margin: 0;
    }
    .container {
      padding: 20px;
    }
    .card {
      background: var(--card);
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .card h3 {
      margin: 0 0 5px;
      color: var(--verde-esc);
    }
    .info {
      font-size: 14px;
      margin: 5px 0;
    }
<!-- Cabeçalho padrão -->
<div style="text-align: center; margin-top: 20px;">
  <img src="logo-aproveitai.png" alt="Logo Aproveitai" height="50">
  <h2>Área do Parceiro</h2>
</div>

<!-- Botão voltar -->
<div style="text-align: center; margin-bottom: 20px;">
  <button onclick="window.history.back()" class="botao">Voltar</button>
</div>

  </style>
</head>
<body>
  <header>
    <img src="logo-prometheus.png" alt="Logo Empresa">
    <h1>Cartão AproveitAI</h1>
    <img src="logo-aproveitai.png" alt="Logo AproveitAI">
  </header>

  <div class="container">
    <h2 style="text-align:center;">Promoções Ativas</h2>
    <div id="promocoes"></div>
    <div id="erro" style="color:red;"></div>
  </div>

  <script>
    const apiKey = 'patXmYwor3EFZGPte.628d2ecfcd251aab41181f5f8f0c601aa042c7195daad22f4178e2c5e0853c67';
    const baseId = 'appMQwMQMQz7dLISZ';
    const tableName = 'promocoes';
    const hoje = new Date().toISOString().split('T')[0];

    axios.get(`https://api.airtable.com/v0/${baseId}/${tableName}?view=Grid%20view`, {
      headers: {
        Authorization: `Bearer ${apiKey}`
      }
    })
    .then(response => {
      const container = document.getElementById('promocoes');
      const registros = response.data.records;

      const ativos = registros.filter(r => {
        const f = r.fields;
        return (
          String(f.ativo || '').toLowerCase() === 'sim' &&
          (!f.grupo || String(f.grupo).toLowerCase() === 'todos') &&
          (!f.dataFim || f.dataFim >= hoje)
        );
      });

      if (!ativos.length) {
        container.innerHTML = "<p>Nenhuma promoção ativa.</p>";
        return;
      }

      ativos.forEach(registro => {
        const dados = registro.fields;
        const card = document.createElement('div');
        card.className = 'card';

        let validade = '';
        if (dados.dataInicio && dados.dataFim) {
          validade = `de ${formatarData(dados.dataInicio)} até ${formatarData(dados.dataFim)}`;
        } else if (dados.dataFim) {
          validade = `até ${formatarData(dados.dataFim)}`;
        }

        card.innerHTML = `
          <h3>${dados.titulo || 'Sem título'}</h3>
          <div class="info">Descrição: ${dados.descricao || '-'}</div>
          <div class="info">Parceiro: ${dados.parceiro || '-'}</div>
          <div class="info">Validade: ${validade || '-'}</div>
          ${dados.instagram ? `<div class="info">Instagram: <a href="https://instagram.com/${formatarInsta(dados.instagram)}" target="_blank">@${formatarInsta(dados.instagram)}</a></div>` : ''}
          ${dados.whatsapp ? `<div class="info">WhatsApp: <a href="https://wa.me/${formatarZap(dados.whatsapp)}" target="_blank">${formatarZap(dados.whatsapp)}</a></div>` : ''}
        `;
        container.appendChild(card);
      });
    })
    .catch(error => {
      console.error('Erro ao carregar promoções:', error);
      document.getElementById('erro').innerText = "Erro ao buscar promoções.";
    });

    function formatarData(dataStr) {
      const [ano, mes, dia] = dataStr.split('-');
      return `${dia}/${mes}/${ano}`;
    }

    function formatarZap(zap) {
      return zap.replace(/\D/g, '');
    }

    function formatarInsta(insta) {
      return insta.replace(/^@/, '');
    }
  </script>
</body>
</html>
